{% extends 'layout.html.twig' %}

{% block title %}
  LibreCores Search
{% endblock %}

{% block pagepath %}Home &raquo; LibreCores Search{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  {% stylesheets filter="cssrewrite"
  "assets/css/instantsearch.min.css" %}
  <link rel="stylesheet" href="{{ asset_url }}"/>
  {% endstylesheets %}
{% endblock %}

{% block content %}
  {# Templates for instant search #}
  <form name="search-form" method="get" action="{{ path('librecores_project_repo_classification_search') }}">
  <div class="row">
    <div class="col-sm-3">
      <h1>Classifications</h1>
      <ul id="classification-hierarchy" class="classification-search"></ul>
    </div>
    <div class="col-sm-9">
      <div class="classification-query">
        {% if searchQuery %}
          <h3>Classifications: </h3>
          {% for classification in searchQuery %}
            <div class="categories">
                        <span>
                          {{ classification }}
                        </span>
              <input class="input-query" type="hidden" name="query[]" value="{{ classification }}">
              <a class="remove-classification" href="#">
                <i class="fa fa-close" aria-hidden="true"></i>
              </a>
            </div>
          {% endfor %}
        {% endif %}
      </div>
      <div class="search-result">
        {% if searchResult %}
          {% if searchResult.hits %}
            <h3>Search Results</h3>
            <div id="stats">
              {{ searchResult.nbHits }} results
              <span class="ais-stats--time">
                in {{ searchResult.processingTimeMS }}ms
              </span>
            </div>
            {% for project in searchResult.hits %}
              <h2><a href="{{ path('librecores_project_repo_project_view', {'parentName':
                  project.parentUserName, 'projectName': project.name}) }}">{{ project.parentUserName }}/{{ project.name }}</a></h2>
              <div>{{ project.tagName }}</div>
              <div class="classification-container">
                {% if project.classifications %}
                  {% for classificationDetails in project.classifications %}
                    <a href="" class="classifiation-tag">{{ classificationDetails }}</a>
                  {% endfor %}
                {% endif %}
              </div>
              <div><i>
                  added on {{ project.dateAdded.date |date('Y-m-d') }}
                </i></div>
              <div class="librecores-project-list-metadata">
                {% if project.mostUsedLanguage %}
                  <span class="metric metric-lang">
                  <i class="fa fa-code"></i>
                  <span class="sr-only">Major language: </span>
                    {{ project.mostUsedLanguage }}
                </span>
                {%  endif %}
                {% if project.dateLastActivityOccurred %}
                  <span class="updated">
                <i class="fa fa-history"></i> Updated {{ project.dateLastActivityOccurred.date | time_diff }}
                </span>
                {% endif %}
              </div>
              <hr/>
            {% endfor %}
          {% endif %}
        {% elseif searchQuery is empty %}
          <div class="searchquery-empty">
            <p>Enter a search query above, or select a filter from the list of classifiers on the left.</p>
            <p>You can combine searches and classifier filters. Examples:</p>
            <ul>
              <li>
                <a href="{{ path('librecores_project_repo_classification_search') }}?query=['License::Free and Open::permissive::MIT']">
                  License::Free and Open::permissive::MIT</a>
              </li>
              <li>
                <a href="{{ path('librecores_project_repo_classification_search') }}?query=['Tool::Simulation::Aldec Riviera']">
                  Tool::Simulation::Aldec Riviera</a>
              </li>
              <li>
                <a href="{{ path('librecores_project_repo_classification_search') }}?query=['License::Free and Open::weak copyleft::Mozilla Public License (MPL)']">
                  License::Free and Open::weak copyleft::Mozilla Public License (MPL)</a>
              </li>
            </ul>
          </div>
        {% else %}
          <p>Nothing found with the classifications:</p>
          <ul>
            {% for classification in searchQuery %}
              <li>
                <a href="#">
                  {{ classification }}</a>
              </li>
            {% endfor %}
          </ul>
          <p>Maybe try with different classification keywords</p>
        {% endif %}
      </div>

    </div>
  </div>
  </form>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  {% javascripts
  'assets/js/instantsearch.js'
  'assets/js/search.js'
  filter="?jsqueeze" %}
  <script src="{{ asset_url }}"></script>
  {% endjavascripts %}
{% endblock %}

{% block pagejs %}
  {# do not use autofocus attribute to work around FF bug 712130 (FOUC) #}

  $(function() {
  var classificationDetails = {
    'id' : null,
    'name' : 'root',
    'children' : {{ classificationHierarchy|json_encode|raw }}
  }
  var classifications = {{ classificationDetails|json_encode|raw }}
  var classificationQuery = {{ searchQuery|json_encode|raw }}
  classificationSearch($('#classification-hierarchy'), classificationDetails, classifications);
  classificationSearchOperation(classificationQuery)
  });
{% endblock %}
